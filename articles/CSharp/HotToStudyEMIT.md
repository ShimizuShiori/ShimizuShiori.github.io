# 如何入门EMIT

## 基本概念

### 什么是IL

对于从事C#工作一段时间的人来说，IL并不陌生。

C#编译器并不会直接将我们的Code编译成机器级语言，而是编译成IL语言，再由相关解释器执行IL中的字节码到机器级语言。

所以说，得到IL是我们编译C#的最终目标

### 什么是反射

接触**反射**应该比接触**IL**还早，**反射**允许我们在程序运行时，访问程序集以及其中类型和成员的机制。

没有**反射**，我们只能在创建一个**指定**的类型，访问一个**指定**的成员等等

> **指定** : 表示硬编码固定的，**if/switch**均属于该范畴

通过**反射**，我们可以在程序运行时，通过对配置文件的修改，创建**任意**的类型，访问一个**任意**的方法等等

**但是**，反射由于其实现的原理，无论在C#还是Java中，都是一种开销较大的机制，该机制在带来系统无限扩张性的同事，也降低了程序的运行效率。

### 什么是EMIT

**EMIT机制**允许我们在编码时，创建IL中间语言。

相对于**反射**提供的动态，EMIT直接创建了IL中间语言。我们可以理解为，一旦IL被创建了，剩下来的事就是解释器进行机器级语言的翻译，因此速度远远远远…………大于**反射**

实事上，利用EMIT优化反射性能只是它的一个小小的作用，他还可以用于代理类动态生成（这才是发挥EMIT真正优势的地方）。

---

## Let's Start

> 本文仅就如何通过EMIT优化反射进行展开，想学习代理类动态生成的同学请关注我以后的文章。

### 目标

对于将一个对象进行拷贝，相信大家都不陌生，可以以下两种手段完成：
* 正/反序列化
    * 二进制
    * Json
    * Xml
    * 其它任何可能反映类型内部状态的序列化方式
* 反射所有Property / Field

#### 反射

反射的代码大致如下：

```csharp
public void Copy<T>(T target)
    where T: new
{
    T result = new T();
    foreach(var property in typeof(T).GetProperties())
    {
        var targetValue = property.GetValue(target, null);
        result.SetValue(target, null);
    }
    return result;
}
```
